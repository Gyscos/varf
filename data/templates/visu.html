<html>
	<head>
		<title>Varf: {{title}}/{{name}}</title>
		<link href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.css" rel="stylesheet" type="text/css">
		<link href="/static/style.css" rel="stylesheet" type="text/css">

	</head>
	<body>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js" charset="utf-8"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.min.js"></script>
		<div class="attribute_list">
			{{#each attributes}}
			<div class="attribute_row">
			<a href="/?att_id={{@index}}">{{.}}</a>
			</div>
			{{/each}}
		</div>
		<div class="graph">
			<h1>{{filename}} ({{title}}) / {{name}}</h1>
			<div id="chart"></div>
			{{#if numeric}}
			<div class="dials">
				<form action="/">
					<input type="hidden" name="att_id" value="{{att_id}}">
					<label>Min: <input name="min" value="{{min}}"></label>
					<label>Max: <input name="max" value="{{max}}"></label>
					<label>Precision: <input name="precision" value="{{precision}}"></label>
					<br><br>
					<input type="submit">
				</form>
			</div>
			{{/if}}

			<script>

var id0 = {{#if numeric}}1{{else}}0{{/if}};
var id1 = {{#if numeric}}2{{else}}1{{/if}};
var rows = [];
var labels = [];
{{#if numeric}}
labels.push('x');
{{/if}}
{{#each classes}}
labels.push('{{.}}');
{{/each}}

{{#each classes}}
labels.push('% of {{.}}');
{{/each}}

rows.push(labels);

{{#each samples}}

	var row = [];

	{{#if ../../numeric}}
		row.push("{{label}}");
	{{/if}}

	var sum = 0;
	{{#each slices_len}}
		sum += {{.}};
		row.push({{.}});
	{{/each}}

	{{#each slices_len}}
		row.push({{.}} / sum);
	{{/each}}

	rows.push(row);

{{/each}}

var chart = c3.generate({
	padding: { top: 10, },
	bindto: '#chart',
	data: {
		{{#if numeric}}
		x: 'x',
		{{/if}}
		rows: rows,
		types: {
			{{#each classes}}
			'{{.}}': {{#if ../../numeric}}'area'{{else}}'bar'{{/if}},
			{{/each}}
		},
		axes: {
			{{#each classes}}
				'% of {{.}}': 'y2',
			{{/each}}
		},

		onclick: function(e) {
			// Find out the slice ID
			var slice_id = e.index;
			
			var name = e.name;

			if (name.startsWith("% of"))
				return;

			var url = "/pop?slice="+slice_id+"&class="+name;
			url += "&att_id=" + {{att_id}};
			{{#if numeric}}
				url += "&precision=" + {{precision}};
				url += "&min=" + {{min}};
				url += "&max=" + {{max}};
			{{/if}}

			window.open(url, "_blank");
			
		},
		hide: [
			{{#each classes}}
				{{#unless @first}}
					'% of {{.}}',
				{{/unless}}
			{{/each}}
		],

		groups: [[{{#each classes}}'{{.}}',{{/each}}]]
	},
	axis: {
		y2: {
			padding: {bottom: 0, top: 10},
			min: 0,
			max: 1,
			show: true,
		},
		{{#if numeric}}
		{{else}}
		x: {
			type: 'category',
			categories: [
			{{#each samples}}
				'{{label}}',
			{{/each}}
			]
		},
		{{/if}}
	},
});

			</script>
		</div>
	</body>
</html>

